
# Actual altitudes from today's ride (502 points)
# Consolidating from the SQL results
altitudes = [
    788, 788, 788, 788, 788, 788, 789.3, 789.3, 791.5, 788, 788, 789.3, 789.3, 789, 789, 789.3, 789.3, 788.9, 791.1, 791.1, 791.1, 791.1, 791.1, 789, 789, 796.6, 796.6, 796.6, 796.6, 796.6, 793.4, 793.4, 793.4, 798.9, 798.9, 798.9, 798.9, 798.9, 798.9, 798.9, 798.9, 792.4, 806.6, 797.3, 797.6, 799, 792.1, 792.1, 801.6, 800.4, 801.6, 802, 806.6, 810.4, 810.4, 806.6, 806.6, 806.8, 806.8, 806.6, 806.6, 810.4, 810.4, 810.4, 810.4, 806.6, 806.6, 806.6, 806.6, 806.4, 806.4, 800.7, 800.7, 802.1, 802.1, 811.3, 811.3, 811.3, 811.3, 802.1, 802.1, 806.4, 806.4, 806.4, 806.4, 800.7, 800.7, 802.1, 802.1, 811.3, 811.3, 811.3, 811.3, 802.1, 802.1, 800.7, 800.7, 802.1, 802.1, 802.1, 802.1, 802.1, 802.1, 802.1, 802.1, 802.1, 812, 812.2, 812.2, 812.2, 812.2, 811.5, 811.5, 808.8, 808.8, 808.8, 805.4, 805.4, 805.4, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 803.9, 803.9, 803.9, 812.2, 812.2, 812.2, 812.2, 812.2, 812.2, 811.5, 811.5, 808.8, 808.8, 808.8, 805.4, 805.4, 805.4, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 802.2, 814.1, 814.5, 815, 815.1, 815.4, 815.5, 815.9, 816.2, 816.1, 816.4, 816.4, 816.7, 818.2, 818.5, 818.8, 816.1, 814.9, 813.1, 813.6, 815.3, 815.8, 815, 814.1, 811.8, 812.8, 813.1, 813.8, 815.2, 815.5, 814.2, 813.3, 811.9, 811.6, 812.3, 813, 814.6, 814.4, 814.3, 811, 809, 809, 808.3, 809.9, 811.8, 811.4, 812.2, 812.7, 812.8, 813.2, 813.1, 812, 814.9, 813.5, 813.5, 813.4, 813, 814, 814.4, 814.5, 814, 814.2, 814.2, 814.4, 814.7, 816.9, 818, 818.4, 816.6, 817.8, 820.6, 824.5, 828.4, 829.8, 829.3, 825, 822, 821.1, 819.2, 817.7, 817.9, 818.5, 818.1, 817.4, 816.7, 815, 815.2, 816.5, 817.2, 817.4, 817.5, 818.7, 818.9, 819.2, 819.1, 819.3, 819.9, 820.8, 821, 821.4, 820.8, 819.2, 818.2, 816.4, 815.4, 815.1, 814.5, 813.4, 812.6, 813.1, 812.7, 812.6,
    # Chunk 2
    812, 812.6, 812.9, 817.6, 817.2, 815.3, 814.9, 815, 814.1, 813.7, 814.1, 814.9, 815.5, 816.1, 817.9, 816.6, 817, 818.2, 818.8, 819.2, 819.2, 819.4, 819.8, 820.8, 821.7, 821.5, 820.9, 821.1, 821.2, 820.5, 820.4, 819.6, 819, 818.9, 818.8, 818.6, 819, 819.8, 818.7, 818, 817.7, 816.9, 817.2, 817.4, 817, 820.6, 822.7, 822.9, 824.3, 824.6, 825.5, 826.8, 827.3, 827.4, 825.9, 825.7, 824.6, 824.8, 824.9, 823.7, 823.8, 823.9, 824, 823.5, 823.1, 821.6, 820.2, 819.5, 818.1, 816.9, 816.1, 815.9, 815.6, 816.3, 816.8, 816.5, 816.2, 815.8, 816, 816.2, 816.1, 816.4, 816.4, 816.7, 818.2, 818.5, 818.8, 816.1, 814.9, 813.1, 813.6, 815.3, 815.8, 815, 814.1, 811.8, 812.8, 813, 814.6, 814.4, 814.3, 811, 809, 809, 808.3, 809.9, 811.8, 811.4, 812.2, 812.7, 812.8, 813.2, 813.1, 812, 814.9, 813.5, 813.5, 813.4, 813, 814, 814.4, 814.5, 814, 814.2, 814.4, 814.7, 816.9, 818, 818.4, 816.6, 817.8, 820.6, 824.5, 828.4, 829.8, 829.3, 825, 822, 821.1, 819.2, 817.7, 817.9, 818.5, 818.1, 817.4, 816.7, 815, 815.2, 816.5, 817.2, 817.4, 817.5, 818.7, 818.9, 819.2, 819.1, 819.3, 819.9, 820.8, 821, 821.4, 820.8, 819.2, 818.2, 816.4, 815.4, 815.1, 814.5, 813.4, 812.6, 813.1, 812.7, 812.6, 811.3, 811.3, 811.3, 811.3, 811.3, 811.3, 811.3, 810.4, 810.4, 810.4, 810.4, 810.4, 810.4, 810.4, 808.1, 807.8, 806.4, 805, 804.9, 806.6, 806.6, 800.1, 800.9, 801.4, 789.5, 789.5, 789.5, 789.5, 789.5, 789.5, 789.5, 789.5, 789.5, 798.9, 798.9, 798.9, 798.9, 802.5, 794.4, 794.4, 790.8, 798.9, 798.9, 793.8, 786.6, 785.4, 796.6, 796.6, 784.1, 784.7, 796.6, 796.6, 785.7, 785.3, 791.1, 788.9, 788.9, 788.8, 788.8, 788.8, 788.8, 789.3, 789.3, 789, 789, 789, 789, 789, 789, 789, 788, 788, 788, 788, 788, 788, 788, 788, 788, 788
]

def current_algorithm(points, threshold=1.0):
    gain = 0.0
    loss = 0.0
    if not points: return 0, 0
    last_alt = points[0]
    for p in points[1:]:
        diff = p - last_alt
        if abs(diff) >= threshold:
            if diff > 0: gain += diff
            else: loss += abs(diff)
            last_alt = p
    return gain, loss

def peak_valley_algorithm(points, prominence=5.0):
    if not points: return 0, 0
    gain, loss = 0.0, 0.0
    current_extrema = points[0]
    last_extrema = points[0]
    trend = 0 
    for p in points[1:]:
        if trend == 0:
            if p > last_extrema + prominence: trend = 1; current_extrema = p
            elif p < last_extrema - prominence: trend = -1; current_extrema = p
        elif trend == 1:
            if p > current_extrema: current_extrema = p
            elif p < current_extrema - prominence:
                gain += (current_extrema - last_extrema)
                last_extrema, current_extrema, trend = current_extrema, p, -1
        elif trend == -1:
            if p < current_extrema: current_extrema = p
            elif p > current_extrema + prominence:
                loss += (last_extrema - current_extrema)
                last_extrema, current_extrema, trend = current_extrema, p, 1
    if trend == 1: gain += (current_extrema - last_extrema)
    elif trend == -1: loss += (last_extrema - current_extrema)
    return gain, loss

print(f"Points count: {len(altitudes)}")
g1, l1 = current_algorithm(altitudes, 1.0)
g5, l5 = current_algorithm(altitudes, 5.0)
pv5, pl5 = peak_valley_algorithm(altitudes, 5.0)
pv10, pl10 = peak_valley_algorithm(altitudes, 10.0)

print(f"Current Algorithm (1.0m): Gain {g1:.1f}, Loss {l1:.1f}")
print(f"Current Algorithm (5.0m): Gain {g5:.1f}, Loss {l5:.1f}")
print(f"Peak-Valley (5.0m):       Gain {pv5:.1f}, Loss {pl5:.1f}")
print(f"Peak-Valley (10.0m):      Gain {pv10:.1f}, Loss {pl10:.1f}")
print(f"Theoretical Net (Max-Start): {max(altitudes) - altitudes[0]:.1f}")
